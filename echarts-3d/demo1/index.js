var geoCoordMapData={
    'Hong Kong': [114.173355,20.320048],
    'Singapore':[103.868811,1.367601],
    'San Jose':[-121.931988,37.336814],
    'Los Angeles':[-118.247045,34.06019],
    'London': [-0.126608, 51.208425],
    'Frankfurt':[2.343598,48.864203],
	    '香港': [114.173355,20.320048,'亚太区'],
    '河内':[105.860369,21.032968,'亚太区'],
    '新加坡':[103.868811,1.367601,'亚太区'],
    '圣何塞':[-121.931988,37.336814,'美洲区'],
    '洛杉矶':[-118.247045,34.06019,'美洲区'],
    '伦敦': [-0.126608, 51.208425,'泛欧区'],
    '巴黎': [2.339574,48.855667,'泛欧区'],
    '法兰克福':[2.343598,48.864203,'泛欧区'],
    '悉尼':[151.211596,-33.852272,'美洲区'],
    '新德里': [77.116626,28.705564,'亚太区'],
'孟买': [72.828928,18.973624,'亚太区'],
'迪拜': [55.31113,25.276578,'美洲区'],
'迈阿密': [-80.19888,25.768303,'美洲区'],
'纽约': [-73.860228,40.854168,'美洲区'],
'西雅图': [-122.324276,47.604156,'美洲区'],

'伊斯坦布尔': [28.988707,41.035888,'美洲区'],
'斯德哥尔摩': [18.075772,59.324364,'美洲区'],
'帕洛阿尔托': [-94.635836,43.12967,'美洲区'],
'芝加哥': [-87.624401,41.884894,'美洲区'],
'达拉斯': [-96.797563,32.775936,'美洲区'],
'圣保罗': [-46.633884,-23.544424,'美洲区'],
'约翰内斯堡': [27.930597,-26.204362,'美洲区'],
'莫斯科': [37.623634,55.755177,'泛欧区'],
'首尔': [126.988892,37.578204,'亚太区'],
'内罗毕': [36.825141,-1.283767,'美洲区'],
'米兰': [9.185958,45.469664,'泛欧区'],
'开罗': [31.2486,30.056662,'泛欧区'],
'富吉拉': [53.883463,23.409485,'美洲区'],
'曼谷': [100.539815,13.743799,'亚太区'],
'吉隆坡': [101.661559,3.120219,'亚太区'],
'暖武里': [100.5251,13.872871,'亚太区'],
'珀斯': [115.861767,-31.940456,'美洲区'],
'唐格朗': [113.802319,-0.913421,'亚太区'],
'雅加达': [106.844302,-6.176927,'亚太区'],
'海参崴': [131.921184,43.117923,'亚太区'],

'阿姆斯特丹': [5.315987,52.125024,'泛欧区'],
'布拉格': [14.446424,50.08941,'泛欧区'],
'澳门': [113.546415,22.191286,'亚太区'],
'拉各斯': [3.371735,6.520201,'美洲区'],
'弗吉尼亚': [-78.277768,35.321516,'美洲区'],
'蒙巴萨': [37.650931,-0.747369,'美洲区'],
'华盛顿': [-77.027097,38.893489,'美洲区'],
'东京': [139.785584,35.711396,'亚太区'],
'胡志明市': [139.785584,35.711396,'亚太区'],
'多伦多': [-79.371686,43.668461,'美洲区'],
    '南宁': [108.479, 23.1152],
    '广州': [113.5107, 23.2196],
    '重庆': [107.7539, 30.1904],
    '芬兰': [24.909912, 60.169095],
    '美国': [-100.696295, 33.679979],
    '日本': [139.710164, 35.706962],
    '韩国': [126.979208, 37.53875],
    '瑞士': [7.445147, 46.956241],
    '东南亚': [117.53244, 5.300343],
    '澳大利亚': [135.193845, -25.304039],
    '德国': [13.402393, 52.518569],
    '英国': [-0.126608, 51.208425],
    '加拿大': [-102.646409, 59.994255]
}
var cityxy={
    "台湾": [
        121.509062,
        21.044332
    ],
    "河北": [
        115.302461,
        38.345474
    ],
    "山西": [
        112.549248,
        37.857014
    ],
    "内蒙古": [
        111.670801,
        40.818311
    ],
    "辽宁": [
        123.429096,
        41.796767
    ],
    "吉林": [
        125.3245,
        42.886841
    ],
    "黑龙江": [
        126.642464,
        45.756967
    ],
    "江苏": [
        119.8674131,
        33.341544
    ],
    "浙江": [
        120.153576,
        29.287459
    ],
    "安徽": [
        117.283042,
        31.86119
    ],
    "福建": [
        116.506239,
        25.75302
    ],
    "江西": [
        115.492151,
        28.676493
    ],
    "山东": [
        118.000923,
        36.675807
    ],
    "河南": [
        113.665412,
        34.757975
    ],
    "湖北": [
        112.298572,
        30.584355
    ],
    "湖南": [
        111.982279,
        28.19409
    ],
    "广东": [
        113.280637,
        24.125178
    ],
    "广西": [
        108.320004,
        22.82402
    ],
    "海南": [
        110.33119,
        20.031971
    ],
    "四川": [
        104.065735,
        30.659462
    ],
    "贵州": [
        106.713478,
        26.578343
    ],
    "云南": [
        102.712251,
        23.040609
    ],
    "西藏": [
        91.132212,
        29.660361
    ],
    "陕西": [
        108.948024,
        34.263161
    ],
    "甘肃": [
        103.823557,
        36.058039
    ],
    "青海": [
        96.778916,
        36.623178
    ],
    "宁夏": [
        106.278179,
        36.46637
    ],
    "新疆": [
        87.617733,
        43.792818
    ],
    "北京": [
        116.405285,
        39.904989
    ],
    "天津": [
        116.790182,
        39.525596
    ],
    "上海": [
        121.472644,
        30.584355
    ],
    "重庆": [
        106.504962,
        29.533155
    ],
    "Hong Kong": [
        114.173355,
        20.320048
    ],
    "澳门": [
        112.54909,
        20.198951
    ]
}
var w=$(window).width()
var h=$(window).height();
$(".echartsMap1").css({"width":w,"height":h})
$(".3dbg div").css({"width":1920*2+"px","margn-left":-1920*2+"px"})
// var x=0,timer;
// timer=setInterval(function(){
//     x++;
//     if(Math.abs(x)>=2000-w){
//         x=0
//     }
//     $(".3dbg div").css({'margin-left':-1920*2+x+"px"})
// },80)
renderEarth()
$(".clickrest").click(function(){
    $("body").find("#echartsMap1").remove()
    var html='<div id="echartsMap1" style="width:100%;height:100%;margin:0 auto;"></div>'
    $("body").append(html)
    renderEarth()
})
function renderEarth(){
    var myChartEarth = echarts.init(document.getElementById('echartsMap1'));
    // 城市、国家 地理坐标
    const geoCoordMap =geoCoordMapData ;
    //国内城市
    var cityxyData=[]
    for(var key in cityxy){
    var json={
        name:key,
        value: [cityxy[key][0],cityxy[key][1], 0]
    }
    cityxyData.push(json)
    }
    var data={
        "linearray":[
            {
                "linecode":"line1",
                "linestart":"node1",
                "linedesc":'',
                "linkarray":[
                    "CN2_CIR000ca"
                ],
                "lineend":"node2",
                "linestat":{
                    "main":3
                }
            }
        ],
        "nodeindex":{
            "nodeclass":[
                {
                    "syscode":"",
                    "nodename":"北京",
                    "nodetype":"node",
                    "nodedesc":"",
                    "nodecode":"node1",
                    "nodestat":{
                        "main":0
                    },
                    "nodeposy":0,
                    "nodeposx":0,
                    "sys":""
                },
                {
                    "syscode":"",
                    "nodename":"上海",
                    "nodetype":"node",
                    "nodedesc":"",
                    "nodecode":"node2",
                    "nodestat":{
                        "main":0
                    },
                    "nodeposy":0,
                    "nodeposx":0,
                    "sys":""
                },
            ]
        }
    }
    
    
    let CQData=[]
    // 连线起始位置
    for(var i=0;i<data.linearray.length;i++){
        var start=data.linearray[i]['linestart']
        var end=data.linearray[i]['lineend']
        var json=[{
            name: start
        }, {
            name: end,
            value: 70
        }];
        CQData.push(json)
    }
    var nodes=data.nodeindex.nodeclass
    function convertData(data) {
        let res = [];
        for (let i = 0; i < data.length; i++) {

            let dataItem = data[i];
            var name1, name0;
            for(var j=0;j<nodes.length;j++){
                if(nodes[j]['nodecode']===dataItem[1].name){
                    name1=nodes[j]['nodename']
                }
                if(nodes[j]['nodecode']===dataItem[0].name){
                    name0=nodes[j]['nodename']
                }
            }
            let [fromCoord, toCoord] = [geoCoordMap[name1], geoCoordMap[name0]];

            if (fromCoord && toCoord) res.push([fromCoord, toCoord]);
        }
        return res;
    }
    let [series2d, series3d,series4d] = [
        [],
        []
    ];
    [
        ['北京', CQData],
        
    ].forEach(function(item) {
        // 3d连线
        series3d.push({
            type: 'lines3D',
            effect: {
                show: true,
                period: 3,
                trailLength: 0.1
            },
            lineStyle: {
                color: '#119650',
                width: 2,
                opacity: 0.8
            },
            tooltip: {
                show: true,
                trigger: 'item',
                formatter() {
                    return '城市连线';
                }
            },
            data: convertData(item[1])
        },{
            type: "scatter3D",
            symbol: 'pin',
            zlevel:3,
            coordinateSystem:'globe',
            symbolSize: 30,
            opacity: 1,
            itemStyle: {
                normal: {
                    color: 'green', //标志颜色
                }
            },
            label: {
                show: true,
                color:'#fff',
                formatter: '{b}',
                position:'center',
                textStyle:{
                    color:'#000',
                }
            },
            blendMode: 'source-over',
            data:item[1].map(function(dataItem) {
                var name=''
                for(var i=0;i<nodes.length;i++){
                    if(nodes[i]['nodecode']===dataItem[1].name){
                        name=nodes[i]['nodename']
                    }
                }
                return {
                    name: name,
                    value: geoCoordMap[name],
                };
            })
        })

        
    });

    let canvas = document.createElement('canvas');
    let mapChart = echarts.init(canvas, null, {
        width: 4096,
        height: 2048
    });
    mapChart.setOption({
        series: [{
            type: 'map',
            map: 'world',
            // 绘制完整尺寸的 echarts 实例
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            boundingCoords: [
                [-180, 90],
                [180, -90]
            ],
            itemStyle:{
                normal:{
                    label:{show:true}
                    ,areaColor:'#3578bb'//设置地图背景色的颜色设置
                    ,color:'rgba(255,0,255,0.8)' //刚才说的图例颜色设置
                },
                emphasis:{label:{show:true}}
            },
        }]
    });
    mapChart.off('click')
    // 添加地球
    let option = {
        globe: {
            baseTexture: './data-1491837049070-rJZtl7Y6x.jpg',
            heightTexture: './data-1491889019097-rJQYikcpl.jpg',
            displacementScale: 0.04,
            shading: 'lambert',
            
            light: { // 光照阴影
                main: {
                    color: '#fff', // 光照颜色
                    intensity: 1.8, // 光照强度
                    shadowQuality: 'high', //阴影亮度
                    shadow: true, // 是否显示阴影
                    alpha: 40,
                    beta: -30
                },
                ambient: {
                    intensity: 0.5
                }
            },
            viewControl: {
                alpha: 30,
                beta: 160,
                // targetCoord: [116.46, 39.92],
                autoRotate: true,
                autoRotateAfterStill: 10,
                distance: 250
            },
            layers: [{
                type: 'blend',
                texture: mapChart
            }]
            
        },
        roam: true,
        series: series3d
    };
    myChartEarth.setOption(option, true);
}

